if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
  Write-Warning "Debes ejecutar este script de PowerShell como administrador."
  exit
}
$updateSession = New-Object -ComObject Microsoft.Update.Session
$updateSearcher = $updateSession.CreateUpdateSearcher()
$updates = $updateSearcher.Search("IsInstalled=0")
if ($updates.Updates.Count -eq 0) {
    Write-Output "No hay actualizaciones disponibles."
    exit
}
$updateDownloader = $updateSession.CreateUpdateDownloader()
$updateDownloader.Updates = $updates.Updates
$updateDownloader.Download()
$updateInstaller = New-Object -ComObject Microsoft.Update.Installer
$updateInstaller.Updates = $updates.Updates
$installResult = $updateInstaller.Install()
if ($installResult.ResultCode -eq 2) {
    Write-Output "Las actualizaciones se instalaron correctamente."
} else {
    Write-Output "Error al instalar las actualizaciones. CÃ³digo de resultado: $($installResult.ResultCode)"
}
